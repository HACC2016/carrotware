(function() {
  'use strict';
  angular
    .module('jgefroh.components')
    .directive('boothMap', Directive);
  function Directive() {
    function Controller($sce, config) {
      var vm = this;
    }


    /**
     * Update a map's viewport to fit each geometry in a dataset
     * @param {google.maps.Map} map The map to adjust
     */
    function zoom(gmap, feature) {
      var bounds = new google.maps.LatLngBounds();

      if(feature) {
        processPoints(feature.getGeometry(), bounds.extend, bounds);
      } else {
        gmap.data.forEach(function(feature) {
          processPoints(feature.getGeometry(), bounds.extend, bounds);
        });
      }
      gmap.fitBounds(bounds);
    }

    /**
     * Process each point in a Geometry, regardless of how deep the points may lie.
     * @param {google.maps.Data.Geometry} geometry The structure to process
     * @param {function(google.maps.LatLng)} callback A function to call on each
     *     LatLng point encountered (e.g. Array.push)
     * @param {Object} thisArg The value of 'this' as provided to 'callback' (e.g.
     *     myArray)
     */
    function processPoints(geometry, callback, thisArg) {
      if (geometry instanceof google.maps.LatLng) {
        callback.call(thisArg, geometry);
      } else if (geometry instanceof google.maps.Data.Point) {
        callback.call(thisArg, geometry.get());
      } else {
        geometry.getArray().forEach(function(g) {
          processPoints(g, callback, thisArg);
        });
      }
    }


    function styleMap(gmap) {
      function computeFeatureStyle(feature) {
        var row = feature.getProperty("row");
        var num = feature.getProperty("num");
        var highlight = feature.getProperty("highlight");

        var colors;
        var alpha = 0.75;
        var highlightColor = "#FFFF00";
        var highlightStrokeColor = "#0000FF";
        colors = "#554422 #dd2211 #CCAA44 #DDCCAA #889933 #22DD11 #AACC44";
        colors = "#366C9F #A68D7A #8FA3C3 #974D25 #CE9D30 #D6D4D6";
        colors = colors.split(" ")

        var color2 = [
          [0.6, 1.0, 0.6],
          [0.5, 0.8, 0.5],
          [0.4, 0.7, 0.4],
          [0.3, 0.6, 0.3],
          [0.2, 0.5, 0.2],
          [0.1, 0.4, 0.1],
          [0.0, 0.3, 0.0]
        ];


        var colorMap = {
          A: 0,
          B: 1,
          C: 2,
          D: 3,
          E: 4,
          F: 5,
          LAWN: 6
        };

        function float2rgb(color) {
          color = color ? color : [1.0, 0.0, 0.0];
          color = color.map(function(c) { return parseInt(c * 255); });
          var tmp = color[1];
          color[1] = color[2];
          color[2] = tmp;
          color = "rgb(" + color.join(",") + ")";
          return color;
        }


        var color = colors[colorMap[row]];
        var strokeColor = color;

        if(highlight) {
          color = highlightColor;
          strokeColor = highlightStrokeColor;
        }

        return {
          fillColor: color,
          fillOpacity: 1.0,
          strokeWidth: 0.5,
          strokeOpacity: 0.75,
          strokeColor: strokeColor
        };
      }


      gmap.data.setStyle(computeFeatureStyle);//{fillColor:'green', fillOpacity: 0.7, strokeColor:'yellow', strokeOpacity:0.7})
    }




    var geojson = {"type": "FeatureCollection", "features": [{"geometry": {"type": "Polygon", "coordinates": [[[-157.8014915666216, 21.26925834785826], [-157.80151999293867, 21.269228755992007], [-157.8014847587783, 21.269194275663068], [-157.80145647927785, 21.26922385544736], [-157.8014915666216, 21.26925834785826], [-157.8014915666216, 21.26925834785826]]]}, "type": "Feature", "id": "A1", "properties": {"num": 1, "center": [-157.8014888728476, 21.26923271656379], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8014517285843, 21.269219545962777], [-157.80148018375803, 21.269189956549617], [-157.80144527981963, 21.269156599003008], [-157.80141769947952, 21.269186013493297], [-157.80145172861327, 21.269219545962777], [-157.8014517285843, 21.269219545962777]]]}, "type": "Feature", "id": "A2", "properties": {"num": 2, "center": [-157.80144932405096, 21.269194332194296], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8014121031258, 21.269180753300194], [-157.80144055830246, 21.26915116389669], [-157.80140251167936, 21.26911456726368], [-157.80137406517545, 21.269144167242523], [-157.8014121031258, 21.269180753300194], [-157.8014121031258, 21.269180753300194]]]}, "type": "Feature", "id": "A3", "properties": {"num": 3, "center": [-157.8014082682818, 21.26915428100066], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80137019329746, 21.26913952513213], [-157.80139794785543, 21.269110295193585], [-157.80136200513576, 21.269075104597817], [-157.8013335499591, 21.26910469401098], [-157.80137019329746, 21.26913952513213], [-157.80137019329746, 21.26913952513213]]]}, "type": "Feature", "id": "A4", "properties": {"num": 4, "center": [-157.80136677790904, 21.269113828813328], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8013303833645, 21.269101434990787], [-157.80135795412406, 21.269072194670063], [-157.80132275617865, 21.269037528417968], [-157.80129430100203, 21.269067117831128], [-157.8013303833645, 21.269101434990787], [-157.8013303833645, 21.269101434990787]]]}, "type": "Feature", "id": "A5", "properties": {"num": 5, "center": [-157.80132715560677, 21.269075942180145], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8012913040571, 21.269064539254348], [-157.80131888386606, 21.269034959470055], [-157.80128219455636, 21.268999447461237], [-157.80128219716397, 21.268999418603595], [-157.80125430768592, 21.269029514107107], [-157.8012913040571, 21.269064539254348], [-157.8012913040571, 21.269064539254348]]]}, "type": "Feature", "id": "A6", "properties": {"num": 6, "center": [-157.80128669856438, 21.269032069691782], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80125073513346, 21.26902578943396], [-157.80127783255242, 21.26899630237463], [-157.8012393227874, 21.26896128672105], [-157.80121184339106, 21.26899178720694], [-157.80125073513346, 21.26902578943396], [-157.80125073513346, 21.26902578943396]]]}, "type": "Feature", "id": "A7", "properties": {"num": 7, "center": [-157.80124609379953, 21.26900019103411], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80120889454219, 21.268989187894768], [-157.80123588783994, 21.268958265998506], [-157.80119554332597, 21.268923084094798], [-157.8011955553983, 21.26892305618363], [-157.8011691900439, 21.268954547728512], [-157.80120889454219, 21.268989187894768], [-157.80120889454219, 21.268989187894768]]]}, "type": "Feature", "id": "A8", "properties": {"num": 8, "center": [-157.8012023276154, 21.268956221632497], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80116565455828, 21.26895060154305], [-157.80119126859998, 21.268920783760507], [-157.8011468138621, 21.26888602595205], [-157.80112766345812, 21.268920751561254], [-157.80116565455828, 21.26895060154305], [-157.80116565455828, 21.26895060154305]]]}, "type": "Feature", "id": "A9", "properties": {"num": 9, "center": [-157.80115941100735, 21.268925752871986], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80112133926033, 21.268917981537026], [-157.80113959980983, 21.26888149689638], [-157.80108843021435, 21.26885775280647], [-157.80107344685143, 21.268895205182414], [-157.80112133926033, 21.268917981537026], [-157.80112133926033, 21.268917981537026]]]}, "type": "Feature", "id": "A10", "properties": {"num": 10, "center": [-157.80110883107926, 21.268894083591864], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80106613343932, 21.26889223987658], [-157.80108024016937, 21.268854670534484], [-157.80102746458064, 21.26883918911655], [-157.8010189853508, 21.268879118903364], [-157.80106613343932, 21.26889223987658]]]}, "type": "Feature", "id": "A11", "properties": {"num": 11, "center": [-157.80104820588502, 21.26886630460774], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80101146311677, 21.26887639718767], [-157.80102126525875, 21.268837939449465], [-157.80096592053863, 21.26882955014383], [-157.8009626102063, 21.268869342006973], [-157.80101146311677, 21.26887639718767], [-157.80101146311677, 21.26887639718767]]]}, "type": "Feature", "id": "A12", "properties": {"num": 12, "center": [-157.80099454444743, 21.26885792519512], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80090868353776, 21.268869679635547], [-157.80095571568384, 21.268869902866953], [-157.80095966613806, 21.268829119307405], [-157.80090564672525, 21.268829041214076], [-157.80090563822634, 21.268829137415864], [-157.80090868353776, 21.268869679635547]]]}, "type": "Feature", "id": "A13", "properties": {"num": 13, "center": [-157.80092707006224, 21.26884537608797], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8008514523123, 21.268876892944128], [-157.80090213670735, 21.268869828549843], [-157.8008978670034, 21.26882966426092], [-157.800843526786, 21.268837006105752], [-157.8008514523123, 21.268876892944128]]]}, "type": "Feature", "id": "A14", "properties": {"num": 14, "center": [-157.80087374570226, 21.268853347965162], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80079505384407, 21.268890146886545], [-157.80084620719506, 21.268878338095636], [-157.80083814044212, 21.268838092806373], [-157.80078453451057, 21.268850465596064], [-157.80079505384407, 21.268890146886545]]]}, "type": "Feature", "id": "A15", "properties": {"num": 15, "center": [-157.80081598399795, 21.268864260846154], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80074132969088, 21.268909839839203], [-157.80078839508892, 21.268891264250822], [-157.80077724803417, 21.268853537582444], [-157.80072494585363, 21.26887317772601], [-157.80074132969088, 21.268909839839203]]]}, "type": "Feature", "id": "A16", "properties": {"num": 16, "center": [-157.80075797966688, 21.26888195484962], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80069807946964, 21.268940287757445], [-157.80073531659156, 21.26891326556344], [-157.80071727235844, 21.26887735457942], [-157.80067401521254, 21.268907691529034], [-157.80067404426333, 21.268907691529034], [-157.80069807946964, 21.268940287757445]]]}, "type": "Feature", "id": "A17", "properties": {"num": 17, "center": [-157.80069974557912, 21.268909258191677], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80065511588356, 21.26897576651431], [-157.80067155151582, 21.268961836387593], [-157.80069355310852, 21.26894429475835], [-157.8006683749929, 21.26891187345281], [-157.8006500398076, 21.268926097641565], [-157.80064998132934, 21.268926001632938], [-157.800626208884, 21.268947066675516], [-157.80062622812244, 21.268947095533154], [-157.80065511588356, 21.26897576651431]]]}, "type": "Feature", "id": "A18", "properties": {"num": 18, "center": [-157.80065513170553, 21.26894250407453], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80061710738963, 21.269016362547497], [-157.80063242857426, 21.26899950876923], [-157.80063236745943, 21.268999458220073], [-157.80065178293256, 21.26897957494028], [-157.80062253890324, 21.2689507753263], [-157.80060084987701, 21.268973430706755], [-157.8006007700839, 21.268973364869233], [-157.80058522099344, 21.268992197665316], [-157.80061710738963, 21.269016362547497]]]}, "type": "Feature", "id": "A19", "properties": {"num": 19, "center": [-157.80061788327671, 21.268985584130586], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8005876220301, 21.269062627310255], [-157.80061442631416, 21.269021200248552], [-157.80058094266508, 21.268997461190377], [-157.80055114821587, 21.26904557668581], [-157.80055106119872, 21.26904557668581], [-157.8005876220301, 21.269062627310255]]]}, "type": "Feature", "id": "A20", "properties": {"num": 20, "center": [-157.80057704008476, 21.26903448842416], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80056757900954, 21.26911049210737], [-157.80058587772686, 21.269067548281242], [-157.80054853074697, 21.26905052142475], [-157.80052943052516, 21.26909535815936], [-157.80056757900954, 21.26911049210737]]]}, "type": "Feature", "id": "A21", "properties": {"num": 21, "center": [-157.80055785450213, 21.26908097999318], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80054826332125, 21.269163399361492], [-157.80056469585332, 21.269117750643638], [-157.80052730618576, 21.269103052486525], [-157.8005097863736, 21.26914908633023], [-157.80054826332125, 21.269163399361492]]]}, "type": "Feature", "id": "A22", "properties": {"num": 22, "center": [-157.8005375129335, 21.269133322205473], "row": "A"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8012499934497, 21.26917414637867], [-157.8012672771662, 21.26915023732312], [-157.8013005514622, 21.269174295186733], [-157.80128324712618, 21.26919820527567], [-157.8012500037546, 21.269174145857146], [-157.8012499934497, 21.26917414637867]]]}, "type": "Feature", "id": "B1", "properties": {"num": 1, "center": [-157.80127021459177, 21.26917420600427], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80123025270035, 21.26920143289821], [-157.8012475336354, 21.269177545920495], [-157.80128079762648, 21.26920160430563], [-157.8012635268901, 21.269225490916345], [-157.80123024232782, 21.269201433496995], [-157.80123025270035, 21.26920143289821]]]}, "type": "Feature", "id": "B2", "properties": {"num": 2, "center": [-157.80125047063603, 21.269201501507535], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80121050910196, 21.269228741572846], [-157.80122779282812, 21.269204832526956], [-157.8012610568192, 21.26922889090243], [-157.80124377315096, 21.269252799871058], [-157.8012104988453, 21.269228742007446], [-157.80121050910196, 21.269228741572846]]]}, "type": "Feature", "id": "B3", "properties": {"num": 3, "center": [-157.8012307261491, 21.269228801376144], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80119075805737, 21.269256028623566], [-157.8012080389731, 21.26923214163619], [-157.80124130296417, 21.269256200011668], [-157.80122402332327, 21.26928007612431], [-157.80119075939015, 21.269256017661913], [-157.80119075805737, 21.269256028623566]]]}, "type": "Feature", "id": "B4", "properties": {"num": 4, "center": [-157.8012109765416, 21.26925609281153], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8011710158497, 21.269283326259284], [-157.8011882954906, 21.2692594501563], [-157.80122156216655, 21.26928348661813], [-157.80120428117354, 21.269307373682764], [-157.80117101718247, 21.26928331529763], [-157.8011710158497, 21.269283326259284]]]}, "type": "Feature", "id": "B5", "properties": {"num": 5, "center": [-157.80119123437257, 21.26928339040282], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80111792942324, 21.26934454907174], [-157.8011693307587, 21.26933456633772], [-157.80116147827468, 21.269294269243776], [-157.8011101057196, 21.2693042553001], [-157.80111792942324, 21.26934454907174]]]}, "type": "Feature", "id": "B6", "properties": {"num": 6, "center": [-157.80113971104407, 21.269319409988334], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80106312560997, 21.269355199336637], [-157.80111452694544, 21.26934521661227], [-157.80110667495396, 21.26930492234808], [-157.801055301916, 21.269314905555337], [-157.80106312560997, 21.269355199336637]]]}, "type": "Feature", "id": "B7", "properties": {"num": 7, "center": [-157.80108490735634, 21.26933006096308], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80100833532737, 21.26936581237054], [-157.8010597039324, 21.26935586471381], [-157.80105188886284, 21.269315581527163], [-157.80100047987838, 21.26932554426945], [-157.80100833532737, 21.26936581237054]]]}, "type": "Feature", "id": "B8", "properties": {"num": 8, "center": [-157.80103010200025, 21.269340700720242], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80095352757368, 21.269376501035026], [-157.80100489815857, 21.269366534381312], [-157.80099707132578, 21.269326269206548], [-157.80099707741022, 21.269326211607165], [-157.80094567607478, 21.269336194534347], [-157.80095352757368, 21.269376501035026]]]}, "type": "Feature", "id": "B93", "properties": {"num": 93, "center": [-157.80097965010862, 21.26934634215288], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8008989759847, 21.26938923241081], [-157.80095010689084, 21.26937715682196], [-157.80094225488972, 21.269336862750926], [-157.80088853411675, 21.269349536450065], [-157.8008989759847, 21.26938923241081]]]}, "type": "Feature", "id": "B10", "properties": {"num": 10, "center": [-157.80091996797051, 21.26936319710844], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8008449972314, 21.26940340549025], [-157.8008955279798, 21.26939011717557], [-157.8008851540548, 21.269350436223114], [-157.80083452508612, 21.269363737305465], [-157.8008449972314, 21.26940340549025]]]}, "type": "Feature", "id": "B11", "properties": {"num": 11, "center": [-157.80086505108804, 21.2693769240486], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80079099591737, 21.26941765501153], [-157.80084160478808, 21.269404350442695], [-157.80083117128385, 21.26936468373556], [-157.80078054466202, 21.269377949016285], [-157.80079099591737, 21.26941765501153]]]}, "type": "Feature", "id": "B12", "properties": {"num": 12, "center": [-157.80081107916283, 21.269391159551517], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80073699649628, 21.269431856282218], [-157.8007876352387, 21.269418533546983], [-157.80077718356807, 21.269378837161288], [-157.80072655462834, 21.26939216033113], [-157.80073699649628, 21.269431856282218]]]}, "type": "Feature", "id": "B13", "properties": {"num": 13, "center": [-157.80075709248285, 21.269405346830403], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80072317386137, 21.269393057361352], [-157.80067215713024, 21.269407015659997], [-157.80068381176264, 21.269447739823807], [-157.80073364510847, 21.269432744871487], [-157.80072317424768, 21.269393047713166], [-157.80072317386137, 21.269393057361352]]]}, "type": "Feature", "id": "B14", "properties": {"num": 14, "center": [-157.80070719242207, 21.26941472108596], "row": "B"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80119305094544, 21.269094954606338], [-157.80122384362943, 21.269100129172998], [-157.80121389481374, 21.269146592983923], [-157.80118317906417, 21.269136419565424], [-157.80119305094544, 21.269094954606338]]]}, "type": "Feature", "id": "C1", "properties": {"num": 1, "center": [-157.8012034921132, 21.26911952408217], "row": "C"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8011503563593, 21.269213387638455], [-157.8011929071112, 21.26916342087917], [-157.80116343384324, 21.269143832569252], [-157.8011221736498, 21.269192942301107], [-157.8011503563593, 21.269213387638455]]]}, "type": "Feature", "id": "C2", "properties": {"num": 2, "center": [-157.8011572177409, 21.269178395846996], "row": "C"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80107602244397, 21.269246748816414], [-157.80112422737102, 21.269236639796418], [-157.80111563157104, 21.269196499632788], [-157.80106671259125, 21.269206905621832], [-157.80107602244397, 21.269246748816414]]]}, "type": "Feature", "id": "C3", "properties": {"num": 3, "center": [-157.8010956484943, 21.26922169846686], "row": "C"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80102096084352, 21.269258806799012], [-157.80106952620133, 21.2692484323042], [-157.80106092789995, 21.269208320911286], [-157.80106093523992, 21.269208234203163], [-157.8010116580507, 21.269218613121268], [-157.80102096084352, 21.269258806799012]]]}, "type": "Feature", "id": "C4", "properties": {"num": 4, "center": [-157.80104480164707, 21.269228481467785], "row": "C"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8009659082152, 21.269270680258842], [-157.80101484029103, 21.269260158124567], [-157.801006245988, 21.269219998567984], [-157.8010062491751, 21.269219960004214], [-157.80095712941838, 21.26923070630671], [-157.8009659082152, 21.269270680258842]]]}, "type": "Feature", "id": "C5", "properties": {"num": 5, "center": [-157.80099007461754, 21.269240300652463], "row": "C"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8009065732795, 21.26928280706324], [-157.80095911149772, 21.269271766660072], [-157.8009499240582, 21.269232669630533], [-157.80089614394743, 21.269244238578537], [-157.8009065732795, 21.26928280706324]]]}, "type": "Feature", "id": "C6", "properties": {"num": 6, "center": [-157.80092793819568, 21.269257870483095], "row": "C"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80084146060614, 21.269300672384787], [-157.8008968407416, 21.269285326630595], [-157.80088592368838, 21.26924670931583], [-157.8008287612461, 21.269264519056485], [-157.80084146060614, 21.269300672384787]]]}, "type": "Feature", "id": "C7", "properties": {"num": 7, "center": [-157.80086324657054, 21.269274306846924], "row": "C"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80075873972234, 21.26933102843762], [-157.80083080302057, 21.26930483834415], [-157.8008179949905, 21.269268352534905], [-157.8007450869013, 21.26929315308673], [-157.80075873972234, 21.26933102843762]]]}, "type": "Feature", "id": "C8", "properties": {"num": 8, "center": [-157.80078815615866, 21.269299343100855], "row": "C"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80067132932746, 21.269361235788622], [-157.8007474433187, 21.269335446138346], [-157.80073430469093, 21.269296570862565], [-157.80065817107496, 21.26932235185941], [-157.80067132932746, 21.269361236184594], [-157.80067132932746, 21.269361235788622]]]}, "type": "Feature", "id": "C9", "properties": {"num": 9, "center": [-157.8006965155479, 21.269335368166708], "row": "C"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80113357261007, 21.269084975233245], [-157.80113322435787, 21.269055047901777], [-157.80118713891548, 21.269054759103263], [-157.801186672007, 21.269084464526447], [-157.80113357261007, 21.269084975233245]]]}, "type": "Feature", "id": "D1", "properties": {"num": 1, "center": [-157.8011601519726, 21.269069811691182], "row": "D"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8010988150334, 21.269119390700098], [-157.80107705151622, 21.26909837973179], [-157.80111381429313, 21.269063101056485], [-157.80113406293881, 21.26908495607208], [-157.8010988150334, 21.269119390700098]]]}, "type": "Feature", "id": "D2", "properties": {"num": 2, "center": [-157.80110593594537, 21.269091456890113], "row": "D"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80102841376322, 21.269157153083185], [-157.80107943717758, 21.269143492893214], [-157.80106881486248, 21.269103844613245], [-157.80101778938135, 21.269117497250782], [-157.80102841376322, 21.269157153083185]]]}, "type": "Feature", "id": "D3", "properties": {"num": 3, "center": [-157.80104861379615, 21.26913049696011], "row": "D"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8009760421138, 21.269171108223716], [-157.80102210853343, 21.269158427541957], [-157.80101099204575, 21.269120028600707], [-157.80096541773193, 21.26913169977699], [-157.8009760421138, 21.269171108223716]]]}, "type": "Feature", "id": "D4", "properties": {"num": 4, "center": [-157.8009936401062, 21.269145316035843], "row": "D"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8009219154313, 21.2691857945886], [-157.8009697561321, 21.269172878013997], [-157.80095913193372, 21.269133221998096], [-157.80091054138825, 21.26914624244281], [-157.8009219154313, 21.2691857945886]]]}, "type": "Feature", "id": "D5", "properties": {"num": 5, "center": [-157.80094033622134, 21.269159534260876], "row": "D"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80086785716497, 21.269200404405414], [-157.80091491107984, 21.269187565673036], [-157.80090428669797, 21.269147909657132], [-157.80085656177542, 21.269160785108635], [-157.80086785716497, 21.269200404405414]]]}, "type": "Feature", "id": "D6", "properties": {"num": 6, "center": [-157.80088590417955, 21.269174166211055], "row": "D"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80081288073706, 21.269215135795168], [-157.8008600658441, 21.269202253138914], [-157.8008494412787, 21.269162606935378], [-157.80080194985385, 21.269175280557256], [-157.80081288073706, 21.269215135795168]]]}, "type": "Feature", "id": "D7", "properties": {"num": 7, "center": [-157.80083108442844, 21.26918881910668], "row": "D"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80075780440842, 21.26922972393012], [-157.80080524928246, 21.269216951170474], [-157.80079462508408, 21.269177295347728], [-157.80079459603328, 21.269177294381944], [-157.8007476829298, 21.269189914847043], [-157.80075780440842, 21.26922972393012]]]}, "type": "Feature", "id": "D8", "properties": {"num": 8, "center": [-157.80077999154759, 21.269198235935463], "row": "D"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80070275284248, 21.269244194867134], [-157.80072298161232, 21.26923897784459], [-157.80072296577347, 21.26923891880619], [-157.80075040442335, 21.26923162920064], [-157.80073977928816, 21.26919200223553], [-157.80073975061404, 21.269191991863007], [-157.80071233478563, 21.26919933334084], [-157.80071232821828, 21.26919933092638], [-157.80069104458008, 21.26920513713536], [-157.80070275284248, 21.269244194867134]]]}, "type": "Feature", "id": "D9", "properties": {"num": 9, "center": [-157.80072159357087, 21.26921572402441], "row": "D"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80065567976644, 21.269270616575017], [-157.80069337033382, 21.269246356099497], [-157.80068071935958, 21.26920799691959], [-157.80065120371302, 21.269220013180302], [-157.80063046964477, 21.269238859709844], [-157.80065567976644, 21.269270616575017]]]}, "type": "Feature", "id": "D10", "properties": {"num": 10, "center": [-157.80066228856353, 21.26923676849685], "row": "D"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80060924541195, 21.269308155929508], [-157.80065006662744, 21.26927550257495], [-157.80062485649609, 21.26924289231369], [-157.8005841555401, 21.26927566049036], [-157.80060924541195, 21.269308155929508]]]}, "type": "Feature", "id": "D11", "properties": {"num": 11, "center": [-157.80061708101888, 21.26927555282713], "row": "D"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80099245206586, 21.268980201029343], [-157.80100315447345, 21.268948189457845], [-157.80105754766416, 21.26897194624782], [-157.80104079329408, 21.268998587971055], [-157.80099245206586, 21.268980201029343]]]}, "type": "Feature", "id": "LAWN1", "properties": {"num": 1, "center": [-157.80102348687439, 21.268974731176517], "row": "LAWN"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8009240539967, 21.268965209157873], [-157.80092681919203, 21.26893449380427], [-157.80099375646392, 21.26894559864457], [-157.80098372075665, 21.268977798263954], [-157.8009240539967, 21.268965209157873]]]}, "type": "Feature", "id": "LAWN2", "properties": {"num": 2, "center": [-157.8009570876023, 21.268955774967665], "row": "LAWN"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80084727482145, 21.26894479977668], [-157.80091538510615, 21.26893265644771], [-157.80091669348326, 21.268965466732578], [-157.8008569843737, 21.268975839778715], [-157.80084727482145, 21.26894479977668], [-157.80084727482145, 21.26894479977668]]]}, "type": "Feature", "id": "LAWN3", "properties": {"num": 3, "center": [-157.8008767225212, 21.268952712502475], "row": "LAWN"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80078542856617, 21.26900312318843], [-157.800773636493, 21.26897257726238], [-157.8008373860003, 21.268948767412212], [-157.80084670430364, 21.268978818586216], [-157.80078542856617, 21.26900312318843]]]}, "type": "Feature", "id": "LAWN4", "properties": {"num": 4, "center": [-157.80081078884078, 21.26897582161231], "row": "LAWN"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80073420642236, 21.269038503956804], [-157.80071344561154, 21.269014496033908], [-157.8007653674565, 21.26897733462949], [-157.80077757252806, 21.26900872659234], [-157.80073420642236, 21.269038503956804]]]}, "type": "Feature", "id": "LAWN5", "properties": {"num": 5, "center": [-157.80074764800463, 21.269009765303135], "row": "LAWN"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80068903870378, 21.26908321584446], [-157.80066563792127, 21.269065545437524], [-157.80070654183686, 21.269020473862778], [-157.80072736186958, 21.269042972119767], [-157.80068903870378, 21.26908321584446]]]}, "type": "Feature", "id": "LAWN6", "properties": {"num": 6, "center": [-157.8006971450829, 21.269053051816133], "row": "LAWN"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80101788862535, 21.269010378460344], [-157.8009805974678, 21.269020895253835], [-157.8009918368612, 21.269060371846308], [-157.80102917266694, 21.269049850948235], [-157.80101793327356, 21.26901037436542], [-157.80101788862535, 21.269010378460344]]]}, "type": "Feature", "id": "E1", "properties": {"num": 1, "center": [-157.80100748577897, 21.26903037417483], "row": "E"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80097551222653, 21.269022325754392], [-157.80093823596138, 21.269032841195784], [-157.8009494737226, 21.269072327871047], [-157.80098674998774, 21.26906181242966], [-157.80097551222653, 21.269022325754392], [-157.80097551222653, 21.269022325754392]]]}, "type": "Feature", "id": "E2", "properties": {"num": 2, "center": [-157.80096509682497, 21.269042326601053], "row": "E"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8009331655932, 21.26903427032493], [-157.80089585957222, 21.269044788489833], [-157.80090711034254, 21.269084194483465], [-157.80094440312263, 21.26907366759753], [-157.80093316535175, 21.269034180922265], [-157.8009331655932, 21.26903427032493]]]}, "type": "Feature", "id": "E3", "properties": {"num": 3, "center": [-157.80092274079647, 21.269054220363603], "row": "E"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80089080247393, 21.26904622634967], [-157.8008535129582, 21.269056733070027], [-157.80086474746471, 21.269096239901213], [-157.80090202373952, 21.269085724469477], [-157.80089078431718, 21.26904624789632], [-157.80089080247393, 21.26904622634967]]]}, "type": "Feature", "id": "E4", "properties": {"num": 4, "center": [-157.8008803741907, 21.269066234337338], "row": "E"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.8008484409675, 21.26905817229162], [-157.80081113492722, 21.26906869045652], [-157.80082237433993, 21.269108167039338], [-157.80085969011532, 21.269097588358385], [-157.8008484555895, 21.269058081517542], [-157.8008484409675, 21.26905817229162]]]}, "type": "Feature", "id": "E5", "properties": {"num": 5, "center": [-157.8008380191879, 21.26907813993268], "row": "E"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80080607782892, 21.269070128326018], [-157.8007687734208, 21.269080636398474], [-157.8007800128142, 21.26912011298129], [-157.80081730397174, 21.269109596168484], [-157.80080606457835, 21.269070119595327], [-157.80080607782892, 21.269070128326018]]]}, "type": "Feature", "id": "E6", "properties": {"num": 6, "center": [-157.80079564652277, 21.269090118693917], "row": "E"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80076370307194, 21.269082065537276], [-157.80072641192405, 21.269092582340424], [-157.80073764970456, 21.26913206899637], [-157.80077494083315, 21.269121552193223], [-157.80076370307194, 21.269082065537276], [-157.80076370307194, 21.269082065537276]]]}, "type": "Feature", "id": "E7", "properties": {"num": 7, "center": [-157.80075328172111, 21.269102066920915], "row": "E"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80072192914875, 21.26912716770807], [-157.80070545795633, 21.269153470180214], [-157.80066693780913, 21.269130095367633], [-157.80068341995357, 21.269103789022694], [-157.8007219423124, 21.26912717492248], [-157.80072192914875, 21.26912716770807]]]}, "type": "Feature", "id": "E8", "properties": {"num": 8, "center": [-157.80069993743604, 21.269128339440222], "row": "E"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80135606917364, 21.269275135103637], [-157.80136628678642, 21.269242630673038], [-157.80140543994736, 21.269254971871916], [-157.80139522438202, 21.269287463138877], [-157.80135608737865, 21.269275016601892], [-157.80135606917364, 21.269275135103637]]]}, "type": "Feature", "id": "F1", "properties": {"num": 1, "center": [-157.8013758215336, 21.269267043477875], "row": "F"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80134421446934, 21.269312842330777], [-157.80135443207246, 21.269280337909834], [-157.8013935892704, 21.269292652762115], [-157.80138336964876, 21.2693251703467], [-157.80134423266472, 21.26931272381937], [-157.80134421446934, 21.269312842330777]]]}, "type": "Feature", "id": "F2", "properties": {"num": 2, "center": [-157.80136396762515, 21.26930474543376], "row": "F"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80133229351222, 21.269350337394393], [-157.80134251112503, 21.26931783298311], [-157.8013816683326, 21.26933014782573], [-157.8013714487013, 21.26936266544895], [-157.80133229151306, 21.26935035057735], [-157.80133229351222, 21.269350337394393]]]}, "type": "Feature", "id": "F3", "properties": {"num": 3, "center": [-157.80135204263684, 21.269342266845907], "row": "F"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.80132020456657, 21.269387962037307], [-157.8013304221697, 21.26935545762602], [-157.801369575321, 21.269367798795926], [-157.8013593597267, 21.269400290072547], [-157.80132020254808, 21.269387975210606], [-157.80132020456657, 21.269387962037307]]]}, "type": "Feature", "id": "F4", "properties": {"num": 4, "center": [-157.8013399528664, 21.269379896748482], "row": "F"}}, {"geometry": {"type": "Polygon", "coordinates": [[[-157.801308688418, 21.269424169565433], [-157.8013189060308, 21.269391665144486], [-157.80135806323835, 21.26940397998711], [-157.80134784359743, 21.26943649761033], [-157.80130864700516, 21.26942418216892], [-157.801308688418, 21.269424169565433]]]}, "type": "Feature", "id": "F5", "properties": {"num": 5, "center": [-157.80132842965796, 21.269416098895256], "row": "F"}}]};

    return {
      restrict: 'A',
      template: '<div style="width: 100%;"><div id="booth-map" style="height: 300px; width: 100%;"></div>' +
                '<div id="drop-container"><div id="drop-silhouette"></div></div>',
      replace: true,
      controller: ['$sce', 'config', Controller],
      controllerAs: 'vm',
      bindToController: true,
      scope: {
        location: '=',
        size: '@',
        onMarketVendorSelected: '&'
      },
      link: function(scope, element, attributes) {

          function initMap() {

            var style = [
              {
                "featureType": "water",
                "stylers": [
                  { "color": "#b5e1e8" }
                ]
              },{
                "featureType": "landscape.man_made",
                "elementType": "geometry.fill",
                "stylers": [
                  { "color": "#e8e2b5" }
                ]
              },{
                "featureType": "landscape.natural",
                "elementType": "geometry.fill",
                "stylers": [
                  { "color": "#e8e2b5" },
                  { "saturation": 25 }
                ]
              },{
                "featureType": "poi.park",
                "elementType": "geometry.fill",
                "stylers": [
                  { "hue": "#f6ff00" },
                  { "saturation": 57 },
                  { "color": "#30d393" }
                ]
              },{
                "featureType": "poi.school",
                "stylers": [
                  { "color": "#e8e2b5" },
                  { "saturation": -45 }
                ]
              },{
              }
            ];

            // set up the map
            var gmap = new google.maps.Map(document.getElementById('booth-map'), {
              center: new google.maps.LatLng(0, 0),
              zoom: 2,
              styles: style,
              streetViewControl: false,
              fullScreenControl: true,
              mapTypeControl: false
            });

            gmap.data.addGeoJson(geojson);
            styleMap(gmap);
            zoom(gmap);
            return gmap;
          }


        var gmap;
        function marketVendorSelectedOnList(marketVendor, gmap) {
          var id = marketVendor.booth_location;
          var feature = gmap.data.getFeatureById(id);
          gmap.data.forEach(function(feature) {
            var fid = feature.getProperty("row") + feature.getProperty("num");
            feature.setProperty("highlight", fid === id);
          });
          styleMap(gmap);
          zoom(gmap, feature);
          var center = feature.getProperty("center");
          var lat = center[1];
          var lon = center[0];
          var row = feature.getProperty("row");
          var num = feature.getProperty("num");

          var info = new google.maps.InfoWindow({
            content: [
              '<div id="content">',
              '<h2">',
              marketVendor.vendor.name,
              '</h2>',
              '<h4>Row ',
              row,
              ", #",
              num,
              '</h4>',

              //'<div id="bodyContent"><p>',
              //marketVendor.vendor.description,
              //'</p></div>',
              '</div>'
            ].join("")
          });

          var marker = new google.maps.Marker({
            position: { lat: lat, lng: lon },
            map: gmap
          });
          info.open(gmap, marker);

        }

        function marketVendorSelectedOnMap(marketVendor) {
          //HEY MCKAY - you can call this function when a marker is selectedo n the map - pass in the instance of MarketVendor.
          scope.vm.onMarketVendorSelected({marketVendor: marketVendor});
        }


        function initialize() {
          gmap = initMap();
          //initEvents();
          scope.$on('market-vendor-selected-on-list', function(event, marketVendor) {
            marketVendorSelectedOnList(marketVendor, gmap);
          });
        }
        initialize();
      }
    };
  }
})();
